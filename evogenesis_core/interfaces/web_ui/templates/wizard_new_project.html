{% extends "layout.html" %}

{% block content %}
<div class="wizard-page">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="page-title">New Project Wizard</h1>
        <a href="/" class="btn btn-outline-secondary">
            <i class='bx bx-x'></i> Cancel
        </a>
    </div>
    
    <!-- Progress indicator -->
    <div class="wizard-progress mb-4">
        <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">Step 1 of 4</div>
        </div>
        <div class="wizard-steps mt-2">
            <div class="wizard-step active">
                <div class="step-number">1</div>
                <div class="step-label">Project Type</div>
            </div>
            <div class="wizard-step">
                <div class="step-number">2</div>
                <div class="step-label">Agent Configuration</div>
            </div>
            <div class="wizard-step">
                <div class="step-number">3</div>
                <div class="step-label">Goals & Tasks</div>
            </div>
            <div class="wizard-step">
                <div class="step-number">4</div>
                <div class="step-label">Review & Create</div>
            </div>
        </div>
    </div>
    
    <!-- Step 1: Project Type -->
    <div id="step-1" class="wizard-step-content active">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">Choose Project Type</h5>
            </div>
            <div class="card-body">
                <p class="mb-4">Select the type of AI project you want to create:</p>
                
                <div class="project-type-grid">
                    <div class="project-type-card" data-type="research">
                        <div class="project-type-icon">
                            <i class='bx bx-search-alt'></i>
                        </div>
                        <h4>Research Project</h4>
                        <p>Research a topic, analyze data, and generate reports with AI assistance.</p>
                        <ul class="feature-list">
                            <li>Web research capabilities</li>
                            <li>Data analysis tools</li>
                            <li>Report generation</li>
                        </ul>
                    </div>
                    
                    <div class="project-type-card" data-type="development">
                        <div class="project-type-icon">
                            <i class='bx bx-code-block'></i>
                        </div>
                        <h4>Development Project</h4>
                        <p>Build software, generate code, and deploy solutions with AI pair programming.</p>
                        <ul class="feature-list">
                            <li>Code generation & review</li>
                            <li>Design pattern suggestions</li>
                            <li>Debugging assistance</li>
                        </ul>
                    </div>
                    
                    <div class="project-type-card" data-type="creative">
                        <div class="project-type-icon">
                            <i class='bx bx-palette'></i>
                        </div>
                        <h4>Creative Project</h4>
                        <p>Create content, generate ideas, and design creative assets with AI collaboration.</p>
                        <ul class="feature-list">
                            <li>Content ideation & generation</li>
                            <li>Design assistance</li>
                            <li>Creative feedback</li>
                        </ul>
                    </div>
                    
                    <div class="project-type-card" data-type="automation">
                        <div class="project-type-icon">
                            <i class='bx bx-cog'></i>
                        </div>
                        <h4>Automation Project</h4>
                        <p>Automate workflows, process data, and optimize operations with AI agents.</p>
                        <ul class="feature-list">
                            <li>Process automation</li>
                            <li>Data processing</li>
                            <li>Optimization algorithms</li>
                        </ul>
                    </div>
                    
                    <div class="project-type-card" data-type="custom">
                        <div class="project-type-icon">
                            <i class='bx bx-customize'></i>
                        </div>
                        <h4>Custom Project</h4>
                        <p>Build a custom AI project with specific requirements and configurations.</p>
                        <ul class="feature-list">
                            <li>Full customization</li>
                            <li>Advanced configuration</li>
                            <li>Specialized agent teams</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-4">
                    <div class="mb-3">
                        <label for="project-name" class="form-label">Project Name</label>
                        <input type="text" class="form-control" id="project-name" placeholder="Enter a name for your project">
                    </div>
                    <div class="mb-3">
                        <label for="project-description" class="form-label">Project Description</label>
                        <textarea class="form-control" id="project-description" rows="3" placeholder="Briefly describe what you want to accomplish"></textarea>
                    </div>
                </div>
            </div>
            <div class="card-footer d-flex justify-content-between">
                <a href="/" class="btn btn-outline-secondary">Cancel</a>
                <button id="next-step-1" class="btn btn-primary">Next <i class='bx bx-right-arrow-alt'></i></button>
            </div>
        </div>
    </div>
    
    <!-- Step 2: Agent Configuration -->
    <div id="step-2" class="wizard-step-content">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">Configure Project Agents</h5>
            </div>
            <div class="card-body">
                <p class="mb-4">Your project will use the following AI agents. You can adjust their settings or add additional agents as needed.</p>
                
                <div id="recommended-agents">
                    <h6>Recommended Agents for <span id="project-type-display">Research</span> Project</h6>
                    <div class="table-responsive mb-4">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Agent Name</th>
                                    <th>Type</th>
                                    <th>Capabilities</th>
                                    <th>Role</th>
                                    <th>Include</th>
                                </tr>
                            </thead>
                            <tbody id="agent-recommendations">
                                <!-- Will be populated dynamically based on project type -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="d-flex justify-content-end mb-4">
                        <button id="add-agent-btn" class="btn btn-outline-primary">
                            <i class='bx bx-plus'></i> Add Custom Agent
                        </button>
                    </div>
                    
                    <h6>Advanced Agent Settings</h6>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="enable-self-improvement" checked>
                            <label class="form-check-label" for="enable-self-improvement">Enable agent self-improvement</label>
                        </div>
                        <small class="text-muted">Agents will learn and adapt to become more effective over time</small>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="enable-team-coordination" checked>
                            <label class="form-check-label" for="enable-team-coordination">Enable team coordination</label>
                        </div>
                        <small class="text-muted">Agents will collaborate as a team with defined roles and responsibilities</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="agent-autonomy" class="form-label">Agent Autonomy Level</label>
                        <select class="form-select" id="agent-autonomy">
                            <option value="low">Low (Frequent human approval)</option>
                            <option value="medium" selected>Medium (Occasional human approval)</option>
                            <option value="high">High (Minimal human approval)</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="card-footer d-flex justify-content-between">
                <button id="prev-step-2" class="btn btn-outline-secondary"><i class='bx bx-left-arrow-alt'></i> Previous</button>
                <button id="next-step-2" class="btn btn-primary">Next <i class='bx bx-right-arrow-alt'></i></button>
            </div>
        </div>
    </div>
    
    <!-- Step 3: Goals & Tasks -->
    <div id="step-3" class="wizard-step-content">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">Define Project Goals & Tasks</h5>
            </div>
            <div class="card-body">
                <p class="mb-4">Define your project's primary goals and initial tasks. EvoGenesis will automatically break these down into actionable steps.</p>
                
                <div class="mb-4">
                    <h6>Primary Goals</h6>
                    <p class="text-muted small">Describe what you want to achieve with this project. Be as specific as possible.</p>
                    
                    <div id="goals-container">
                        <div class="goal-item mb-3">
                            <div class="input-group">
                                <span class="input-group-text"><i class='bx bx-target-lock'></i></span>
                                <input type="text" class="form-control" placeholder="Enter a project goal...">
                                <button class="btn btn-outline-secondary remove-goal" type="button"><i class='bx bx-trash'></i></button>
                            </div>
                        </div>
                    </div>
                    
                    <button id="add-goal-btn" class="btn btn-outline-primary btn-sm mt-2">
                        <i class='bx bx-plus'></i> Add Another Goal
                    </button>
                </div>
                
                <div class="mb-4">
                    <h6>Initial Tasks</h6>
                    <p class="text-muted small">Define some initial tasks to get started. The AI will suggest additional tasks based on your goals.</p>
                    
                    <div id="tasks-container">
                        <div class="task-item mb-3">
                            <div class="input-group">
                                <span class="input-group-text"><i class='bx bx-task'></i></span>
                                <input type="text" class="form-control" placeholder="Enter an initial task...">
                                <select class="form-select task-priority" style="max-width: 120px;">
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                </select>
                                <button class="btn btn-outline-secondary remove-task" type="button"><i class='bx bx-trash'></i></button>
                            </div>
                        </div>
                    </div>
                    
                    <button id="add-task-btn" class="btn btn-outline-primary btn-sm mt-2">
                        <i class='bx bx-plus'></i> Add Another Task
                    </button>
                </div>
                
                <div class="mb-3">
                    <h6>Auto-Generate Tasks</h6>
                    <p class="text-muted small">Let EvoGenesis analyze your goals and generate recommended tasks.</p>
                    <button id="generate-tasks-btn" class="btn btn-outline-secondary">
                        <i class='bx bx-bulb'></i> Generate Recommended Tasks
                    </button>
                </div>
            </div>
            <div class="card-footer d-flex justify-content-between">
                <button id="prev-step-3" class="btn btn-outline-secondary"><i class='bx bx-left-arrow-alt'></i> Previous</button>
                <button id="next-step-3" class="btn btn-primary">Next <i class='bx bx-right-arrow-alt'></i></button>
            </div>
        </div>
    </div>
    
    <!-- Step 4: Review & Create -->
    <div id="step-4" class="wizard-step-content">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">Review & Create Project</h5>
            </div>
            <div class="card-body">
                <p class="mb-4">Review your project configuration before creating it.</p>
                
                <div class="review-section mb-4">
                    <h6>Project Information</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <tbody>
                                <tr>
                                    <th style="width: 30%;">Project Name</th>
                                    <td id="review-project-name">-</td>
                                </tr>
                                <tr>
                                    <th>Project Type</th>
                                    <td id="review-project-type">-</td>
                                </tr>
                                <tr>
                                    <th>Description</th>
                                    <td id="review-project-description">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="review-section mb-4">
                    <h6>Project Agents</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Agent Name</th>
                                    <th>Type</th>
                                    <th>Role</th>
                                </tr>
                            </thead>
                            <tbody id="review-agents">
                                <!-- Will be populated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="review-section mb-4">
                    <h6>Project Goals</h6>
                    <ul id="review-goals" class="list-group">
                        <!-- Will be populated dynamically -->
                    </ul>
                </div>
                
                <div class="review-section mb-4">
                    <h6>Initial Tasks</h6>
                    <ul id="review-tasks" class="list-group">
                        <!-- Will be populated dynamically -->
                    </ul>
                </div>
                
                <div class="form-check mb-4">
                    <input class="form-check-input" type="checkbox" id="auto-start" checked>
                    <label class="form-check-label" for="auto-start">
                        Automatically start project after creation
                    </label>
                </div>
            </div>
            <div class="card-footer d-flex justify-content-between">
                <button id="prev-step-4" class="btn btn-outline-secondary"><i class='bx bx-left-arrow-alt'></i> Previous</button>
                <button id="create-project-btn" class="btn btn-success">
                    <i class='bx bx-check'></i> Create Project
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add Custom Agent Modal -->
<div class="modal fade" id="addAgentModal" tabindex="-1" aria-labelledby="addAgentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addAgentModalLabel">Add Custom Agent</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="add-agent-form">
                    <div class="mb-3">
                        <label for="agent-name-input" class="form-label">Agent Name</label>
                        <input type="text" class="form-control" id="agent-name-input" required>
                    </div>
                    <div class="mb-3">
                        <label for="agent-type-select" class="form-label">Agent Type</label>
                        <select class="form-select" id="agent-type-select" required>
                            <option value="">Select a type</option>
                            <option value="assistant">Assistant</option>
                            <option value="researcher">Researcher</option>
                            <option value="developer">Developer</option>
                            <option value="coordinator">Coordinator</option>
                            <option value="planner">Planner</option>
                            <option value="critic">Critic</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="agent-description-input" class="form-label">Description</label>
                        <textarea class="form-control" id="agent-description-input" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="agent-capabilities-input" class="form-label">Capabilities (comma-separated)</label>
                        <input type="text" class="form-control" id="agent-capabilities-input">
                    </div>
                    <div class="mb-3">
                        <label for="agent-role-input" class="form-label">Role in Project</label>
                        <input type="text" class="form-control" id="agent-role-input" placeholder="e.g., Lead, Assistant, Specialist">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="add-custom-agent-btn">Add Agent</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Project configuration data
    let projectConfig = {
        projectName: "",
        projectType: "",
        projectDescription: "",
        agents: [],
        goals: [],
        tasks: [],
        settings: {
            autoStart: true,
            selfImprovement: true,
            teamCoordination: true,
            autonomyLevel: "medium"
        }
    };
    
    // Agent recommendations by project type
    const agentRecommendations = {
        research: [
            { name: "Research Coordinator", type: "coordinator", capabilities: ["coordination", "planning", "communication"], role: "Lead" },
            { name: "Information Analyst", type: "researcher", capabilities: ["web_research", "data_analysis", "summarization"], role: "Analyst" },
            { name: "Report Generator", type: "assistant", capabilities: ["text_generation", "formatting", "visualization"], role: "Assistant" }
        ],
        development: [
            { name: "Development Lead", type: "coordinator", capabilities: ["coordination", "planning", "code_review"], role: "Lead" },
            { name: "Code Generator", type: "developer", capabilities: ["code_generation", "testing", "debugging"], role: "Developer" },
            { name: "QA Specialist", type: "critic", capabilities: ["testing", "quality_assurance", "feedback"], role: "QA" }
        ],
        creative: [
            { name: "Creative Director", type: "coordinator", capabilities: ["coordination", "ideation", "feedback"], role: "Lead" },
            { name: "Content Creator", type: "assistant", capabilities: ["content_generation", "editing", "formatting"], role: "Creator" },
            { name: "Design Specialist", type: "assistant", capabilities: ["visual_design", "layout", "styling"], role: "Designer" }
        ],
        automation: [
            { name: "Automation Manager", type: "coordinator", capabilities: ["coordination", "process_design", "optimization"], role: "Lead" },
            { name: "Process Analyst", type: "researcher", capabilities: ["process_analysis", "data_processing", "workflow_design"], role: "Analyst" },
            { name: "Implementation Agent", type: "developer", capabilities: ["automation_scripting", "integration", "testing"], role: "Developer" }
        ],
        custom: [
            { name: "Project Coordinator", type: "coordinator", capabilities: ["coordination", "planning", "communication"], role: "Lead" }
        ]
    };
    
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize the wizard
        initializeWizard();
        
        // Set up event listeners for project type selection
        const projectTypeCards = document.querySelectorAll('.project-type-card');
        projectTypeCards.forEach(card => {
            card.addEventListener('click', function() {
                // Deselect all cards
                projectTypeCards.forEach(c => c.classList.remove('selected'));
                
                // Select this card
                this.classList.add('selected');
                
                // Update project type
                projectConfig.projectType = this.getAttribute('data-type');
                
                // Update recommended agents for this project type
                updateAgentRecommendations(projectConfig.projectType);
            });
        });
        
        // Next/Previous buttons for wizard navigation
        document.getElementById('next-step-1').addEventListener('click', function() {
            // Validate step 1
            const projectName = document.getElementById('project-name').value;
            const projectDescription = document.getElementById('project-description').value;
            
            if (!projectName) {
                showNotification('Please enter a project name', 'warning');
                return;
            }
            
            if (!projectConfig.projectType) {
                showNotification('Please select a project type', 'warning');
                return;
            }
            
            // Save values
            projectConfig.projectName = projectName;
            projectConfig.projectDescription = projectDescription;
            
            // Move to step 2
            goToStep(2);
        });
        
        document.getElementById('prev-step-2').addEventListener('click', function() {
            goToStep(1);
        });
        
        document.getElementById('next-step-2').addEventListener('click', function() {
            // Save agent settings
            projectConfig.settings.selfImprovement = document.getElementById('enable-self-improvement').checked;
            projectConfig.settings.teamCoordination = document.getElementById('enable-team-coordination').checked;
            projectConfig.settings.autonomyLevel = document.getElementById('agent-autonomy').value;
            
            // Collect selected agents
            projectConfig.agents = [];
            document.querySelectorAll('#agent-recommendations tr').forEach(row => {
                const checkbox = row.querySelector('input[type="checkbox"]');
                if (checkbox && checkbox.checked) {
                    projectConfig.agents.push({
                        name: row.getAttribute('data-name'),
                        type: row.getAttribute('data-type'),
                        capabilities: row.getAttribute('data-capabilities').split(','),
                        role: row.getAttribute('data-role')
                    });
                }
            });
            
            // Move to step 3
            goToStep(3);
        });
        
        document.getElementById('prev-step-3').addEventListener('click', function() {
            goToStep(2);
        });
        
        document.getElementById('next-step-3').addEventListener('click', function() {
            // Collect goals
            projectConfig.goals = [];
            document.querySelectorAll('#goals-container .goal-item input').forEach(input => {
                if (input.value.trim()) {
                    projectConfig.goals.push(input.value.trim());
                }
            });
            
            if (projectConfig.goals.length === 0) {
                showNotification('Please define at least one project goal', 'warning');
                return;
            }
            
            // Collect tasks
            projectConfig.tasks = [];
            document.querySelectorAll('#tasks-container .task-item').forEach(item => {
                const taskInput = item.querySelector('input');
                const prioritySelect = item.querySelector('select');
                
                if (taskInput.value.trim()) {
                    projectConfig.tasks.push({
                        description: taskInput.value.trim(),
                        priority: prioritySelect.value
                    });
                }
            });
            
            // Update review page
            updateReviewPage();
            
            // Move to step 4
            goToStep(4);
        });
        
        document.getElementById('prev-step-4').addEventListener('click', function() {
            goToStep(3);
        });
        
        // Add goal button
        document.getElementById('add-goal-btn').addEventListener('click', function() {
            addGoalInput();
        });
        
        // Add task button
        document.getElementById('add-task-btn').addEventListener('click', function() {
            addTaskInput();
        });
        
        // Remove goal/task buttons (using event delegation)
        document.getElementById('goals-container').addEventListener('click', function(e) {
            if (e.target.closest('.remove-goal')) {
                e.target.closest('.goal-item').remove();
            }
        });
        
        document.getElementById('tasks-container').addEventListener('click', function(e) {
            if (e.target.closest('.remove-task')) {
                e.target.closest('.task-item').remove();
            }
        });
        
        // Add custom agent button
        document.getElementById('add-agent-btn').addEventListener('click', function() {
            const modal = new bootstrap.Modal(document.getElementById('addAgentModal'));
            modal.show();
        });
        
        // Add custom agent from modal
        document.getElementById('add-custom-agent-btn').addEventListener('click', function() {
            const name = document.getElementById('agent-name-input').value;
            const type = document.getElementById('agent-type-select').value;
            const description = document.getElementById('agent-description-input').value;
            const capabilities = document.getElementById('agent-capabilities-input').value
                                .split(',')
                                .map(cap => cap.trim())
                                .filter(cap => cap);
            const role = document.getElementById('agent-role-input').value || "Specialist";
            
            if (!name || !type) {
                showNotification('Agent name and type are required', 'warning');
                return;
            }
            
            // Add to recommendations table
            addAgentToTable({
                name: name,
                type: type,
                capabilities: capabilities,
                role: role
            }, true);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addAgentModal'));
            modal.hide();
            
            // Clear form
            document.getElementById('add-agent-form').reset();
        });
        
        // Generate tasks button
        document.getElementById('generate-tasks-btn').addEventListener('click', function() {
            // Get all goals
            const goals = [];
            document.querySelectorAll('#goals-container .goal-item input').forEach(input => {
                if (input.value.trim()) {
                    goals.push(input.value.trim());
                }
            });
            
            if (goals.length === 0) {
                showNotification('Please define at least one project goal first', 'warning');
                return;
            }
            
            // Show loading state
            const button = this;
            button.disabled = true;
            button.innerHTML = '<i class="bx bx-loader-alt bx-spin"></i> Generating...';
            
            // Simulate AI task generation (would be an API call in a real implementation)
            setTimeout(() => {
                // Generate 3-5 tasks based on goals
                const generatedTasks = [
                    "Research current state of the industry",
                    "Create project timeline and milestones",
                    "Identify key stakeholders and resources",
                    "Perform initial data collection"
                ];
                
                // Add these tasks to the UI
                generatedTasks.forEach(task => {
                    const taskInput = addTaskInput();
                    taskInput.value = task;
                });
                
                // Reset button
                button.disabled = false;
                button.innerHTML = '<i class="bx bx-bulb"></i> Generate Recommended Tasks';
                
                showNotification('Generated ' + generatedTasks.length + ' recommended tasks', 'success');
            }, 2000);
        });
        
        // Create project button
        document.getElementById('create-project-btn').addEventListener('click', function() {
            // Update auto-start setting
            projectConfig.settings.autoStart = document.getElementById('auto-start').checked;
            
            // Show loading state
            const button = this;
            button.disabled = true;
            button.innerHTML = '<i class="bx bx-loader-alt bx-spin"></i> Creating Project...';
            
            // Simulate project creation (would be an API call in a real implementation)
            setTimeout(() => {
                // Reset button
                button.disabled = false;
                button.innerHTML = '<i class="bx bx-check"></i> Create Project';
                
                // Show success message
                showNotification('Project "' + projectConfig.projectName + '" created successfully!', 'success');
                
                // Redirect to the dashboard after a short delay
                setTimeout(() => {
                    window.location.href = '/';
                }, 1500);
            }, 3000);
        });
    });
    
    // Initialize the wizard
    function initializeWizard() {
        // Hide all steps except the first one
        document.querySelectorAll('.wizard-step-content').forEach(step => {
            step.classList.remove('active');
        });
        document.getElementById('step-1').classList.add('active');
        
        // Add initial goal and task inputs
        addGoalInput();
        addTaskInput();
    }
    
    // Go to a specific step in the wizard
    function goToStep(stepNumber) {
        // Update progress bar
        const progressBar = document.querySelector('.progress-bar');
        progressBar.style.width = (stepNumber * 25) + '%';
        progressBar.setAttribute('aria-valuenow', stepNumber * 25);
        progressBar.textContent = 'Step ' + stepNumber + ' of 4';
        
        // Update step indicators
        document.querySelectorAll('.wizard-step').forEach((step, index) => {
            if (index < stepNumber) {
                step.classList.add('active');
                step.classList.add('completed');
            } else if (index === stepNumber - 1) {
                step.classList.add('active');
                step.classList.remove('completed');
            } else {
                step.classList.remove('active');
                step.classList.remove('completed');
            }
        });
        
        // Show the correct step content
        document.querySelectorAll('.wizard-step-content').forEach(step => {
            step.classList.remove('active');
        });
        document.getElementById('step-' + stepNumber).classList.add('active');
    }
    
    // Update recommended agents based on project type
    function updateAgentRecommendations(projectType) {
        const recommendationsTable = document.getElementById('agent-recommendations');
        recommendationsTable.innerHTML = '';
        
        document.getElementById('project-type-display').textContent = 
            projectType.charAt(0).toUpperCase() + projectType.slice(1);
        
        // Get recommendations for this project type
        const recommendations = agentRecommendations[projectType] || [];
        
        // Add each recommended agent to the table
        recommendations.forEach(agent => {
            addAgentToTable(agent);
        });
    }
    
    // Add an agent to the recommendations table
    function addAgentToTable(agent, selected = false) {
        const recommendationsTable = document.getElementById('agent-recommendations');
        
        const row = document.createElement('tr');
        row.setAttribute('data-name', agent.name);
        row.setAttribute('data-type', agent.type);
        row.setAttribute('data-capabilities', agent.capabilities.join(','));
        row.setAttribute('data-role', agent.role);
        
        row.innerHTML = `
            <td>${agent.name}</td>
            <td>${agent.type}</td>
            <td>${agent.capabilities.map(cap => `<span class="badge bg-secondary">${cap}</span>`).join(' ')}</td>
            <td>${agent.role}</td>
            <td><div class="form-check">
                <input class="form-check-input" type="checkbox" ${selected ? 'checked' : ''}>
            </div></td>
        `;
        
        recommendationsTable.appendChild(row);
    }
    
    // Add a new goal input field
    function addGoalInput() {
        const goalsContainer = document.getElementById('goals-container');
        
        const goalItem = document.createElement('div');
        goalItem.className = 'goal-item mb-3';
        goalItem.innerHTML = `
            <div class="input-group">
                <span class="input-group-text"><i class='bx bx-target-lock'></i></span>
                <input type="text" class="form-control" placeholder="Enter a project goal...">
                <button class="btn btn-outline-secondary remove-goal" type="button"><i class='bx bx-trash'></i></button>
            </div>
        `;
        
        goalsContainer.appendChild(goalItem);
        return goalItem.querySelector('input');
    }
    
    // Add a new task input field
    function addTaskInput() {
        const tasksContainer = document.getElementById('tasks-container');
        
        const taskItem = document.createElement('div');
        taskItem.className = 'task-item mb-3';
        taskItem.innerHTML = `
            <div class="input-group">
                <span class="input-group-text"><i class='bx bx-task'></i></span>
                <input type="text" class="form-control" placeholder="Enter an initial task...">
                <select class="form-select task-priority" style="max-width: 120px;">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                </select>
                <button class="btn btn-outline-secondary remove-task" type="button"><i class='bx bx-trash'></i></button>
            </div>
        `;
        
        tasksContainer.appendChild(taskItem);
        return taskItem.querySelector('input');
    }
    
    // Update the review page with the current configuration
    function updateReviewPage() {
        // Project information
        document.getElementById('review-project-name').textContent = projectConfig.projectName;
        document.getElementById('review-project-type').textContent = 
            projectConfig.projectType.charAt(0).toUpperCase() + projectConfig.projectType.slice(1);
        document.getElementById('review-project-description').textContent = 
            projectConfig.projectDescription || "No description provided";
        
        // Agents
        const agentsTable = document.getElementById('review-agents');
        agentsTable.innerHTML = '';
        
        if (projectConfig.agents.length > 0) {
            projectConfig.agents.forEach(agent => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${agent.name}</td>
                    <td>${agent.type}</td>
                    <td>${agent.role}</td>
                `;
                agentsTable.appendChild(row);
            });
        } else {
            const row = document.createElement('tr');
            row.innerHTML = '<td colspan="3" class="text-center">No agents selected</td>';
            agentsTable.appendChild(row);
        }
        
        // Goals
        const goalsList = document.getElementById('review-goals');
        goalsList.innerHTML = '';
        
        if (projectConfig.goals.length > 0) {
            projectConfig.goals.forEach(goal => {
                const item = document.createElement('li');
                item.className = 'list-group-item';
                item.textContent = goal;
                goalsList.appendChild(item);
            });
        } else {
            const item = document.createElement('li');
            item.className = 'list-group-item text-center';
            item.textContent = 'No goals defined';
            goalsList.appendChild(item);
        }
        
        // Tasks
        const tasksList = document.getElementById('review-tasks');
        tasksList.innerHTML = '';
        
        if (projectConfig.tasks.length > 0) {
            projectConfig.tasks.forEach(task => {
                const item = document.createElement('li');
                item.className = 'list-group-item d-flex justify-content-between align-items-center';
                
                const priorityClass = 
                    task.priority === 'high' ? 'danger' :
                    task.priority === 'medium' ? 'warning' : 'info';
                
                item.innerHTML = `
                    ${task.description}
                    <span class="badge bg-${priorityClass}">${task.priority}</span>
                `;
                
                tasksList.appendChild(item);
            });
        } else {
            const item = document.createElement('li');
            item.className = 'list-group-item text-center';
            item.textContent = 'No tasks defined';
            tasksList.appendChild(item);
        }
        
        // Auto-start checkbox
        document.getElementById('auto-start').checked = projectConfig.settings.autoStart;
    }
    
    // Show a notification
    function showNotification(message, type = 'info') {
        // Create toast container if it doesn't exist
        let toastContainer = document.querySelector('.toast-container');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
            document.body.appendChild(toastContainer);
        }
        
        // Create the toast
        const toastId = 'toast-' + Date.now();
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.setAttribute('role', 'alert');
        toast.setAttribute('aria-live', 'assertive');
        toast.setAttribute('aria-atomic', 'true');
        toast.id = toastId;
        
        // Set the toast content
        toast.innerHTML = `
            <div class="toast-header">
                <strong class="me-auto">${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                ${message}
            </div>
        `;
        
        // Add type-specific styling
        if (type === 'success') {
            toast.querySelector('.toast-header').classList.add('text-success');
        } else if (type === 'warning') {
            toast.querySelector('.toast-header').classList.add('text-warning');
        } else if (type === 'error') {
            toast.querySelector('.toast-header').classList.add('text-danger');
        }
        
        // Add the toast to the container
        toastContainer.appendChild(toast);
        
        // Initialize and show the toast
        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();
        
        // Remove toast after it's hidden
        toast.addEventListener('hidden.bs.toast', function() {
            toast.remove();
        });
    }
</script>

<style>
    /* Wizard-specific styles */
    .wizard-progress {
        margin-bottom: 2rem;
    }
    
    .wizard-steps {
        display: flex;
        justify-content: space-between;
    }
    
    .wizard-step {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        width: 25%;
        position: relative;
    }
    
    .wizard-step:not(:last-child)::after {
        content: '';
        position: absolute;
        top: 12px;
        right: -50%;
        width: 100%;
        height: 2px;
        background-color: var(--border-color);
        z-index: 0;
    }
    
    .wizard-step.active .step-number,
    .wizard-step.completed .step-number {
        background-color: var(--primary-color);
        color: white;
    }
    
    .wizard-step.completed:not(:last-child)::after {
        background-color: var(--primary-color);
    }
    
    .step-number {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background-color: var(--text-muted);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        margin-bottom: 0.5rem;
        position: relative;
        z-index: 1;
    }
    
    .step-label {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }
    
    .wizard-step.active .step-label {
        color: var(--text-color);
        font-weight: 500;
    }
    
    .wizard-step-content {
        display: none;
    }
    
    .wizard-step-content.active {
        display: block;
    }
    
    /* Project type selection */
    .project-type-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .project-type-card {
        border: 1px solid var(--border-color);
        border-radius: var(--card-border-radius);
        padding: 1.5rem;
        transition: all 0.2s;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    
    .project-type-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .project-type-card.selected {
        border-color: var(--primary-color);
        box-shadow: 0 5px 15px rgba(0, 120, 212, 0.2);
    }
    
    .project-type-icon {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
    }
    
    .project-type-card h4 {
        margin-bottom: 0.8rem;
    }
    
    .project-type-card p {
        color: var(--text-secondary);
        margin-bottom: 1rem;
        font-size: 0.9rem;
    }
    
    .feature-list {
        text-align: left;
        padding-left: 1.5rem;
        margin-bottom: 0;
        width: 100%;
    }
    
    .feature-list li {
        font-size: 0.85rem;
        margin-bottom: 0.3rem;
        color: var(--text-secondary);
    }
</style>
{% endblock %}
